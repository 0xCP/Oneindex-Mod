# OneIndex-MOD  
Onedrive Directory Index  
改动自downwa提供的Oneindex，此为自用改动版本。  

## 改动内容  
### 适用情况  
适用于有较快php空间、小文件长时间展示不修改的情况。  
比如展示多个小文件html，展示markdown等。
### 原版缓存机制  
设置有缓存时间。所有缓存，包括文件夹和需要的文件，超过缓存刷新时间的则刷新缓存，从微软处重新获取。  
### 改后缓存机制  
文件夹改为手动刷新。由于文件下载链接有效时间为1小时，打开文件的时候判断，展示时如果是已经缓存了的模式（流输出&&代码&markdown等)则从缓存读取并展示，否则通过时间判断url是否过期，如果超过1h-10s就从新更新文件所处文件夹的缓存（文件下载url在文件夹中），然后再执行展示。  
### 其它新增内容
增加文件夹内容更新后手动刷新当前目录功能。  
修改了显示目录时的标题。  
增加了对于指定扩展名无论get/post都展示功能。  
修改了密码保存机制，不直接存储管理密码，而是将密码md5加密后存储。  
新增了切换代理功能。 
新增了重新绑定账户功能，登录管理并访问?reauth或&reauth以重新安装（配置不变）。  
### 配置代理
编辑index.php内的函数，函数参数为OneDrive直链，id为选择的代理序号，返回代理后的链接。
#### 腾讯云cdn
选择TypeA鉴权模式
函数格式：qcloudcdn($url,key)
返回内容：cdn的路径
自己看示例

### 期望增加的功能  
防止加密文件夹子文件夹访问绕过。  

## 安装运行
**请参考downwa的安装教程**  
<img width="658" alt="image" src="https://raw.githubusercontent.com/donwa/oneindex/files/images/install.gif">  

## 必要配置
由于只改了filecache，缓存方式务必选择filecache。  
由于缓存自动更新，请修改缓存过期时间为无穷大，比如233333333。  
还有其它配置写在index.php前面。请用代码编辑器打开并修改。  
